<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script type="text/javascript" src="https://lib.sinaapp.com/js/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="js/html2canvas.js"></script>
    <link rel="stylesheet" type="text/css" href="css/maker.css" />
    <title>弹幕生成器</title>
</head>

<body>
    <div id="danmako_container">
        <img id="danmako_img"src="test.png" />
        <div class="danmako_screen">
            <div class="s_dm">
                <div class="s_show"></div>
            </div>
        </div>
    </div>
</body>

<script type="text/javascript">
$(document).ready(function(){
    init();
    html2canvas($('#danmako_container')).then(function(canvas) {
        var dataUrl = canvas.toDataURL('image/png');
        console.log(dataUrl);
    });
});



function init(){
    var fakes = [
        "Sogou 第二届黑客马拉松",
        "Biztech 万岁！",
        "评委老师们好~",
        "我是萌萌的弹幕~~~~",
        "前方高能",
        "刚才那个是假高能",
        "我来承包！",
        "PHP是违反广告法的语言！",
        "小鲜肉团队荣誉出品",
        "双十一我要剁手剁手剁手！",
        "折腾了一下午TMD代码没提交….",
        "这个逼装的我给一百分",
        "川总在哪里！！？？",
        "活捉川总一只！",
        "么么哒"];
    for(var i = 0; i < fakes.length; i++) {
        post(fakes[i]);
    }

    $('#danmako_container').width($('#danmako_img').width());
    $('#danmako_container').height($('#danmako_img').height());
    init_screen();
}

function post(message) {
     $(".s_show").append("<div>" + message + "</div>");
}

//初始化弹幕
function init_screen() {
    $(".s_show").find("div").show().each(function () {
        var _width = $('#danmako_img').width();
        var _height = $('#danmako_img').height();

        var _left = Math.random()*(_width);
        var _top = Math.random()*(_height);

        if(_top + $(this).height() > _height){
            _top = _height - $(this).height();
        }

        if(_left + $(this).width() > _width){
            _left = _width - $(this).width();
        }

        //设定文字的位置
        $(this).css({
            left: _left,
            top: _top,
            color: getRandomColor()
        });

    });
}


//随机获取颜色值
function getRandomColor() {
    return '#' + (function (h) {
            return new Array(7 - h.length).join("0") + h
        })((Math.random() * 0x1000000 << 0).toString(16))
}
</script>

</html>